var Qe=Object.defineProperty,Ze=Object.defineProperties;var et=Object.getOwnPropertyDescriptors;var Fe=Object.getOwnPropertySymbols;var tt=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable;var De=(t,n,s)=>n in t?Qe(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,C=(t,n)=>{for(var s in n||(n={}))tt.call(n,s)&&De(t,s,n[s]);if(Fe)for(var s of Fe(n))nt.call(n,s)&&De(t,s,n[s]);return t},L=(t,n)=>Ze(t,et(n));import{R as e,c as y,r as m,f as fe,E as Te,a as re,b as st,d as Q,e as Ee,u as Ae,g as ot,h as B,i as Le,j as he,k as oe,l as at,m as xe,n as rt,o as ye,p as lt,q as ct,s as it,t as le,v as ut,A as mt,F as dt,w as pt,x as ft,N as Et,y as ht,z as $e,B as xt,H as yt}from"./vendor.27a003f4.js";const vt=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=s(a);fetch(a.href,r)}};vt();function J(t){const{title:n,children:s,className:o,style:a}=t;return e.createElement("header",{className:y("header",o),style:a},e.createElement("h1",{className:"md:text-xl"},n),e.createElement("div",{className:"flex flex-auto items-center justify-end"},s))}function H(t){const{type:n,size:s=14,className:o,style:a}=t,r=y("clash-iconfont",`icon-${n}`,o),l=C({fontSize:s},a),c=L(C({},t),{className:r,style:l});return e.createElement("i",C({},c))}function _(){}function gt(t,n){const s=[],o=[];for(const a of t)n(a)?s.push(a):o.push(a);return[s,o]}function Z(t){const n=["B","KB","MB","GB","TB"];let s=0;for(;~~(t/1024)&&s<n.length;)t/=1024,s++;return`${s===0?t:t.toFixed(2)} ${n[s]}`}function wt(t){const{className:n,checked:s=!1,disabled:o=!1,onChange:a=_}=t,r=y("switch",{checked:s,disabled:o},n);function l(){o||a(!s)}return e.createElement("div",{className:r,onClick:l},e.createElement(H,{className:"switch-icon font-bold",type:"check",size:20}))}const W=m.exports.forwardRef((t,n)=>{const{className:s,style:o,children:a}=t;return e.createElement("div",{className:y("card",s),style:o,ref:n},a)});function ve(t){const{options:n,value:s,onSelect:o}=t;return e.createElement("div",{className:"button-select"},n.map(a=>e.createElement("button",{value:a.value,key:a.value,className:y("button-select-options",{actived:s===a.value},"flex-wrap"),onClick:()=>o==null?void 0:o(a.value)},a.label)))}const bt={SideBar:{Proxies:"Proxies",Overview:"Overview",Logs:"Logs",Rules:"Rules",Settings:"Setting",Connections:"Connect",Version:"Version"},Settings:{title:"Settings",labels:{startAtLogin:"Start at login",language:"Language",setAsSystemProxy:"Set as system proxy",allowConnectFromLan:"Allow connect from Lan",proxyMode:"Mode",logLevel:"Log Level",socks5ProxyPort:"Socks5 Port",redirProxyPort:"Redir Port",httpProxyPort:"HTTP Port",mixedProxyPort:"Mixed Port",externalController:"External Controller"},values:{cn:"\u4E2D\u6587",en:"English",global:"Global",rules:"Rules",direct:"Direct",script:"Script"},versionString:"Current ClashX is the latest version\uFF1A{{version}}",checkUpdate:"Check Update",externalControllerSetting:{title:"External Controller",note:"Please note that modifying this configuration will only configure Dashboard. Will not modify your Clash configuration file. Please make sure that the external controller address matches the address in the Clash configuration file, otherwise, Dashboard will not be able to connect to Clash.",host:"Host",port:"Port",secret:"Secret"}},Logs:{title:"Logs"},Rules:{title:"Rules",providerTitle:"Providers",providerUpdateTime:"Last updated at",ruleCount:"Rule count"},Connections:{title:"Connections",keepClosed:"Keep closed connections",total:{text:"total",upload:"upload",download:"download"},closeAll:{title:"Warning",content:"This would close all connections"},filter:{all:"All"},columns:{host:"Host",network:"Network",process:"Process",type:"Type",chains:"Chains",rule:"Rule",time:"Time",upload:"UL",download:"DL",uploadSpeed:"UL Speed",downloadSpeed:"DL Speed",speed:"Speed",sourceIP:"Source IP"},info:{title:"Connection",id:"ID",host:"Host",hostEmpty:"Empty",dstIP:"IP",dstIPEmpty:"Empty",srcIP:"Source",upload:"Upload",download:"Download",network:"Network",process:"Process",inbound:"Inbound",rule:"Rule",chains:"Chains",status:"Status",opening:"Open",closed:"Closed",closeConnection:"Close"}},Proxies:{title:"Proxies",editDialog:{title:"Edit Proxy",color:"Color",name:"Name",type:"Type",server:"Server",port:"Port",password:"Password",cipher:"Cipher",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"Policy Group",providerTitle:"Providers",providerCount:"Total",providerUpdateTime:"Last updated at",expandText:"Expand",collapseText:"Close",speedTestText:"Test",breakConnectionsText:"Break Connections"},Modal:{ok:"Ok",cancel:"Cancel"}},Nt={SideBar:{Proxies:"\u4EE3\u7406",Overview:"\u603B\u89C8",Logs:"\u65E5\u5FD7",Rules:"\u89C4\u5219",Settings:"\u8BBE\u7F6E",Connections:"\u8FDE\u63A5",Version:"\u7248\u672C"},Settings:{title:"\u8BBE\u7F6E",labels:{startAtLogin:"\u5F00\u673A\u65F6\u542F\u52A8",language:"\u8BED\u8A00",setAsSystemProxy:"\u8BBE\u7F6E\u4E3A\u7CFB\u7EDF\u4EE3\u7406",allowConnectFromLan:"\u5141\u8BB8\u6765\u81EA\u5C40\u57DF\u7F51\u7684\u8FDE\u63A5",proxyMode:"\u4EE3\u7406\u6A21\u5F0F",logLevel:"\u4FE1\u606F\u7B49\u7EA7",socks5ProxyPort:"Socks5 \u7AEF\u53E3",redirProxyPort:"Redir \u7AEF\u53E3",httpProxyPort:"HTTP \u7AEF\u53E3",mixedProxyPort:"\u6DF7\u5408\u7AEF\u53E3",externalController:"\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E"},values:{cn:"\u4E2D\u6587",en:"English",global:"\u5168\u5C40",rules:"\u89C4\u5219",direct:"\u76F4\u8FDE",script:"\u811A\u672C"},versionString:"\u5F53\u524D ClashX \u5DF2\u662F\u6700\u65B0\u7248\u672C\uFF1A{{version}}",checkUpdate:"\u68C0\u67E5\u66F4\u65B0",externalControllerSetting:{title:"\u7F16\u8F91\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E",note:"\u8BF7\u6CE8\u610F\uFF0C\u4FEE\u6539\u8BE5\u914D\u7F6E\u9879\u5E76\u4E0D\u4F1A\u4FEE\u6539\u4F60\u7684 Clash \u914D\u7F6E\u6587\u4EF6\uFF0C\u8BF7\u786E\u8BA4\u4FEE\u6539\u540E\u7684\u5916\u90E8\u63A7\u5236\u5730\u5740\u548C Clash \u914D\u7F6E\u6587\u4EF6\u5185\u7684\u5730\u5740\u4E00\u81F4\uFF0C\u5426\u5219\u4F1A\u5BFC\u81F4 Dashboard \u65E0\u6CD5\u8FDE\u63A5\u3002",host:"Host",port:"\u7AEF\u53E3",secret:"\u5BC6\u94A5"}},Logs:{title:"\u65E5\u5FD7"},Rules:{title:"\u89C4\u5219",providerTitle:"\u89C4\u5219\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",ruleCount:"\u89C4\u5219\u6761\u6570"},Connections:{title:"\u8FDE\u63A5",keepClosed:"\u4FDD\u7559\u5173\u95ED\u8FDE\u63A5",total:{text:"\u603B\u91CF",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D"},closeAll:{title:"\u8B66\u544A",content:"\u5C06\u4F1A\u5173\u95ED\u6240\u6709\u8FDE\u63A5"},filter:{all:"\u5168\u90E8"},columns:{host:"\u57DF\u540D",network:"\u7F51\u7EDC",process:"\u8FDB\u7A0B",type:"\u7C7B\u578B",chains:"\u8282\u70B9\u94FE",rule:"\u89C4\u5219",time:"\u8FDE\u63A5\u65F6\u95F4",speed:"\u901F\u7387",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",uploadSpeed:"\u4E0A\u4F20\u901F\u7387",downloadSpeed:"\u4E0B\u8F7D\u901F\u7387",sourceIP:"\u6765\u6E90 IP"},info:{title:"\u8FDE\u63A5\u4FE1\u606F",id:"ID",host:"\u57DF\u540D",hostEmpty:"\u7A7A",dstIP:"IP",dstIPEmpty:"\u7A7A",srcIP:"\u6765\u6E90",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",network:"\u7F51\u7EDC",process:"\u8FDB\u7A0B",inbound:"\u5165\u53E3",rule:"\u89C4\u5219",chains:"\u4EE3\u7406",status:"\u72B6\u6001",opening:"\u8FDE\u63A5\u4E2D",closed:"\u5DF2\u5173\u95ED",closeConnection:"\u5173\u95ED\u8FDE\u63A5"}},Proxies:{title:"\u4EE3\u7406",editDialog:{title:"\u7F16\u8F91\u4EE3\u7406",color:"\u989C\u8272",name:"\u540D\u5B57",type:"\u7C7B\u578B",server:"\u670D\u52A1\u5668",port:"\u7AEF\u53E3",password:"\u5BC6\u7801",cipher:"\u52A0\u5BC6\u65B9\u5F0F",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"\u7B56\u7565\u7EC4",providerTitle:"\u4EE3\u7406\u96C6",providerCount:"\u6570\u91CF",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",expandText:"\u5C55\u5F00",collapseText:"\u6536\u8D77",speedTestText:"\u6D4B\u901F",breakConnectionsText:"\u5207\u6362\u65F6\u6253\u65AD\u5DF2\u6709\u8FDE\u63A5"},Modal:{ok:"\u786E \u5B9A",cancel:"\u53D6 \u6D88"}},Be={en_US:bt,zh_CN:Nt},Ct=Object.keys(Be);function Pt(){for(const t of window.navigator.languages){if(t.includes("zh"))return"zh_CN";if(t.includes("us"))return"en_US"}return"en_US"}function ge(t){return m.exports.useMemo(()=>{function s(o,a){if(typeof o=="string")t(r=>{const l=o,c=a;r[l]=c});else if(typeof o=="function"){const r=o;t(l=>r(l))}else typeof o=="object"&&t(r=>fe(r,l=>{const c=o;for(const i of Object.keys(c)){const f=i;l[f]=c[f]}}))}return s},[t])}function Ie(){return navigator.userAgent==="ClashX Runtime"}let kt=null;class Re{constructor(n){this.EE=new Te,this.innerBuffer=[],this.isClose=!1,this.config=Object.assign({bufferLength:0,retryInterval:5e3,headers:{}},n),this.config.useWebsocket?this.websocketLoop():this.loop()}websocketLoop(){var o;const n=new URL(this.config.url);n.protocol=n.protocol==="http:"?"ws:":"wss:",n.searchParams.set("token",(o=this.config.token)!=null?o:"");const s=new WebSocket(n.toString());s.addEventListener("message",a=>{const r=JSON.parse(a.data);this.EE.emit("data",[r]),this.config.bufferLength>0&&(this.innerBuffer.push(r),this.innerBuffer.length>this.config.bufferLength&&this.innerBuffer.splice(0,this.innerBuffer.length-this.config.bufferLength))}),s.addEventListener("close",()=>setTimeout(this.websocketLoop,this.config.retryInterval)),s.addEventListener("error",a=>{this.EE.emit("error",a),setTimeout(this.websocketLoop,this.config.retryInterval)})}async loop(){const n=await re.fromPromise(fetch(this.config.url,{mode:"cors",headers:this.config.token?{Authorization:`Bearer ${this.config.token}`}:{}}),a=>a);if(n.isErr()){this.retry(n.error);return}else if(n.value.body==null){this.retry(new Error("fetch body error"));return}const s=n.value.body.getReader(),o=new TextDecoder;for(;!this.isClose;){const a=await re.fromPromise(s==null?void 0:s.read(),c=>c);if(a.isErr()){this.retry(a.error);break}const l=o.decode(a.value.value).trim().split(`
`).map(c=>JSON.parse(c));this.EE.emit("data",l),this.config.bufferLength>0&&(this.innerBuffer.push(...l),this.innerBuffer.length>this.config.bufferLength&&this.innerBuffer.splice(0,this.innerBuffer.length-this.config.bufferLength))}}retry(n){this.isClose||(this.EE.emit("error",n),window.setTimeout(()=>{this.loop()},this.config.retryInterval))}subscribe(n,s){this.EE.addListener(n,s)}unsubscribe(n,s){this.EE.removeListener(n,s)}buffer(){return this.innerBuffer.slice()}destory(){this.EE.removeAllListeners(),this.isClose=!0}}class St{constructor(n,s){this.axiosClient=st.create({baseURL:n,headers:s?{Authorization:`Bearer ${s}`}:{}})}async getConfig(){return await this.axiosClient.get("configs")}async updateConfig(n){return await this.axiosClient.patch("configs",n)}async getRules(){return await this.axiosClient.get("rules")}async getProxyProviders(){const n=await this.axiosClient.get("providers/proxies",{validateStatus(s){return s>=200&&s<300||s===404}});return n.status===404&&(n.data={providers:{}}),n}async getRuleProviders(){return await this.axiosClient.get("providers/rules")}async updateProvider(n){return await this.axiosClient.put(`providers/proxies/${encodeURIComponent(n)}`)}async updateRuleProvider(n){return await this.axiosClient.put(`providers/rules/${encodeURIComponent(n)}`)}async healthCheckProvider(n){return await this.axiosClient.get(`providers/proxies/${encodeURIComponent(n)}/healthcheck`)}async getProxies(){return await this.axiosClient.get("proxies")}async getProxy(n){return await this.axiosClient.get(`proxies/${encodeURIComponent(n)}`)}async getVersion(){return await this.axiosClient.get("version")}async getProxyDelay(n){return await this.axiosClient.get(`proxies/${encodeURIComponent(n)}/delay`,{params:{timeout:5e3,url:"http://www.gstatic.com/generate_204"}})}async closeAllConnections(){return await this.axiosClient.delete("connections")}async closeConnection(n){return await this.axiosClient.delete(`connections/${n}`)}async getConnections(){return await this.axiosClient.get("connections")}async changeProxySelected(n,s){return await this.axiosClient.put(`proxies/${encodeURIComponent(n)}`,{name:s})}}const Ft=Q(async()=>{if(!Ie())return null;const t=await kt.getAPIInfo();return{hostname:t.host,port:t.port,secret:t.secret,protocol:"http:"}}),Me=Ee("externalControllers",[]);function ce(){var f,u,p,E,x,w,P,N,k,$,j,M,O,V,q,G;const t=Ae(Ft),n=ot(),s=Ae(Me);if(t!=null)return t;let o;{const U=document.querySelector('meta[name="external-controller"]');((f=U==null?void 0:U.content)==null?void 0:f.match(/^https?:/))!=null&&(o=new URL(U.content))}const a=new URLSearchParams(n.search),r=(w=(x=(E=(u=a.get("host"))!=null?u:a.get("hostname"))!=null?E:(p=s==null?void 0:s[0])==null?void 0:p.hostname)!=null?x:o==null?void 0:o.hostname)!=null?w:"127.0.0.1",l=($=(k=(N=a.get("port"))!=null?N:(P=s==null?void 0:s[0])==null?void 0:P.port)!=null?k:o==null?void 0:o.port)!=null?$:"9090",c=(V=(O=(M=a.get("secret"))!=null?M:(j=s==null?void 0:s[0])==null?void 0:j.secret)!=null?O:o==null?void 0:o.username)!=null?V:"",i=((q=a.get("protocol"))!=null?q:r==="127.0.0.1")?"http:":(G=o==null?void 0:o.protocol)!=null?G:window.location.protocol;return{hostname:r,port:l,secret:c,protocol:i}}const Dt=Q({key:"",instance:null});function I(){const{hostname:t,port:n,secret:s,protocol:o}=ce(),[a,r]=B(Dt),l=`${o}//${t}:${n}?secret=${s}`;if(a.key===l)return a.instance;const c=new St(`${o}//${t}:${n}`,s);return r({key:l,instance:c}),c}const we=Q(!0),Tt=Ee("language",void 0);function D(){const[t,n]=B(Tt),s=m.exports.useMemo(()=>t!=null?t:Pt(),[t]),o=m.exports.useCallback(function(a){function r(l){return at(Be[s][a],l)}return{t:r}},[s]);return{lang:s,locales:Ct,setLang:n,translation:o}}const be=Q({version:"",meta:!1,premium:!1});function ie(){const[t,n]=B(be),s=I(),o=he(we);return oe([s],async function(){const a=await re.fromPromise(s.getVersion(),r=>r);o(a.isOk()),n(a.isErr()?{version:"",meta:!1,premium:!1}:{version:a.value.data.version,meta:!!a.value.data.meta,premium:!!a.value.data.premium})}),t}function Oe(){const[{meta:t}]=B(be),[{premium:n}]=B(be),s=I(),{data:o,mutate:a}=oe(["/providers/rule",s,t,n],async()=>{if(!t&&!n)return[];const r=await s.getRuleProviders();return Object.keys(r.data.providers).map(l=>r.data.providers[l])});return{providers:o!=null?o:[],update:a}}const At=Ee("profile",{breakConnections:!1});function Ue(){const[t,n]=B(At),s=m.exports.useCallback(o=>{n(fe(t,o))},[t,n]);return{data:t,set:ge(s)}}const He=Q([]);function je(){const[t,n]=B(He),s=I(),{data:o,mutate:a}=oe(["/providers/proxy",s],async()=>{const r=await s.getProxyProviders();return Object.keys(r.data.providers).map(l=>r.data.providers[l]).filter(l=>l.name!=="default").filter(l=>l.vehicleType!=="Compatible")});return m.exports.useEffect(()=>{n(o!=null?o:[])},[o,n]),{providers:t,update:a}}function Ne(){const t=I(),{data:n,mutate:s}=oe(["/config",t],async()=>{var r;const a=(await t.getConfig()).data;return{port:a.port,socksPort:a["socks-port"],mixedPort:(r=a["mixed-port"])!=null?r:0,redirPort:a["redir-port"],mode:a.mode.toLowerCase(),logLevel:a["log-level"],allowLan:a["allow-lan"]}});return{general:n!=null?n:{},update:s}}const ze=Le({proxies:[],groups:[],global:{name:"GLOBAL",type:"Selector",now:"",history:[],all:[]}});function ae(){const[t,n]=B(ze),s=ge(n),o=I(),{mutate:a}=oe(["/proxies",o],async()=>{const l=await o.getProxies(),c=l.data.proxies.GLOBAL;c.name="GLOBAL";const i=new Set(["Selector","URLTest","Fallback","LoadBalance"]),f=new Set(["DIRECT","REJECT","GLOBAL"]),u=c.all.filter(x=>!f.has(x)).map(x=>L(C({},l.data.proxies[x]),{name:x})),[p,E]=gt(u,x=>!i.has(x.type));s({proxies:p,groups:E,global:c})}),r=m.exports.useCallback((l,c)=>{s(i=>{l==="GLOBAL"&&(i.global.now=c);for(const f of i.groups)f.name===l&&(f.now=c)})},[s]);return{proxies:t.proxies,groups:t.groups,global:t.global,update:a,markProxySelected:r,set:s}}const We=Q(t=>{const n=t(ze),s=t(He),o=new Map;for(const a of n.proxies)o.set(a.name,a);for(const a of s)for(const r of a.proxies)o.set(r.name,r);return o}),Lt=Le([]);function $t(){const[t,n]=B(Lt),s=ge(n),o=I();async function a(){const r=await o.getRules();s(r.data.rules)}return{rules:t,update:a}}const Bt=Q({key:"",instance:null});function Ge(){var u,p;const t=ce(),{general:n}=Ne(),s=ie(),[o,a]=B(Bt);if(!s.version||!n.logLevel)return null;const r=!!s.version||!0,l=`${t.protocol}//${t.hostname}:${t.port}/logs?level=${(u=n.logLevel)!=null?u:""}&useWebsocket=${r}&secret=${t.secret}`;if(o.key===l)return o.instance;const c=o.instance,i=`${t.protocol}//${t.hostname}:${t.port}/logs?level=${(p=n.logLevel)!=null?p:""}`,f=new Re({url:i,bufferLength:200,token:t.secret,useWebsocket:r});return a({key:l,instance:f}),c!=null&&c.destory(),f}function It(){const t=ce(),n=ie(),s=!!n.version||!0,o=`${t.protocol}//${t.hostname}:${t.port}/connections`;return m.exports.useMemo(()=>n.version?new Re({url:o,bufferLength:200,token:t.secret,useWebsocket:s}):null,[t.secret,o,s,n.version])}function Rt(t){const{className:n,title:s,data:o,onClick:a,select:r,canClick:l,errSet:c,rowHeight:i}=t,{translation:f}=D(),{t:u}=f("Proxies"),[p,E]=m.exports.useState(!1),[x,w]=m.exports.useState(!1),[P]=B(We),{proxies:N,groups:k}=ae(),{set:$}=ae(),[j,M]=m.exports.useState(!1),O=m.exports.useRef(null);m.exports.useLayoutEffect(()=>{var b,T;w(((T=(b=O==null?void 0:O.current)==null?void 0:b.offsetHeight)!=null?T:0)>45)},[]);const V=p?"auto":i,q=l?a:_;function G(){E(!p)}const U=I();async function te(){M(!0);for(let b of k)if(b.name===s){for(let T of b.all)for(let ne of N)if(T===ne.name){const R=await re.fromPromise(g(T),S=>S),A=R.isErr()?0:R.value;$(S=>{const z=S.proxies.find(se=>se.name===T);z!=null&&z.history.push({time:Date.now().toString(),delay:A})})}break}setTimeout(function(){M(!1)},500)}const g=m.exports.useCallback(async b=>{const{data:{delay:T}}=await U.getProxyDelay(b);return T},[U]),X=o.map(b=>{var se,K;const T=y({"tags-selected":r===b,"cursor-pointer":l,"cursor-default":!l,error:c==null?void 0:c.has(b)});let ne;for(let d of k)if(d.name===b){ne=d.type;break}const R=(se=P.get(b))==null?void 0:se.history,A=(K=P.get(b))==null?void 0:K.type,S=(R==null?void 0:R.length)?R.slice(-1)[0].delay:0;let z;return S==0?z="#909399":S<=260?z="#226600":S<=400?z="#a75c00":S<=1/0&&(z="#970000"),e.createElement("li",{className:T,key:b,onClick:()=>q(b)},e.createElement("span",{className:"overflow-hidden whitespace-nowrap overflow-ellipsis",title:b},b),e.createElement("div",{className:"flex flex-row justify-between"},e.createElement("p",{style:{fontSize:"xx-small"}},A==="Shadowsocks"?"SS":A==="ShadowsocksR"?"SSR":A||ne),e.createElement("p",{style:{fontSize:"xx-small",textAlign:"end",color:z}}," ",(R==null?void 0:R.length)&&S!==0?S+"ms":""," ")))});return e.createElement(e.Fragment,null,e.createElement("div",{id:"facebook",style:{display:j?"":"none"}},e.createElement("div",{className:"bar"}),e.createElement("div",{className:"bar"}),e.createElement("div",{className:"bar"})),e.createElement("div",{className:y("flex items-start overflow-y-hidden transition-all",n),style:{height:s=="GLOBAL"?"AUTO":V,display:j?"none":""}},e.createElement("ul",{ref:O,className:y("tags",{expand:p})},X),e.createElement("div",{className:"flex flex-row justify-end",style:{width:"80px"}},e.createElement("div",null,e.createElement(H,{className:"h-7 select-none leading-7 text-xs text-center speed-icon cursor-pointer",type:"speed",size:10,onClick:te}),e.createElement("span",{className:"proxies-speed-test h-7 select-none cursor-pointer leading-7 text-xs text-center rule-provider-loading",onClick:te},u("speedTestText"))),s!=="GLOBAL"&&x&&e.createElement("span",{className:"h-7 select-none cursor-pointer leading-7 text-xs text-center",style:{paddingLeft:"10px"},onClick:G}," ",u(p?"collapseText":"expandText")," "))))}function ee(t){const{className:n,style:s,value:o="",align:a="center",inside:r=!1,autoFocus:l=!1,type:c="text",disabled:i=!1,onChange:f=_,onBlur:u=_,onEnter:p=_}=t,E=y("input",`text-${a}`,{"focus:shadow-none":r},n);function x(w){w.code==="Enter"&&p(w)}return e.createElement("input",{disabled:i,className:E,style:s,value:o,autoFocus:l,type:c,onChange:w=>f(w.target.value,w),onBlur:u,onKeyDown:x})}function _e(t){const{show:n=!0,title:s="Modal",size:o="small",footer:a=!0,onOk:r=_,onClose:l=_,bodyClassName:c,bodyStyle:i,className:f,style:u,children:p}=t,{translation:E}=D(),{t:x}=E("Modal"),w=m.exports.useRef(document.createElement("div")),P=m.exports.useRef(null);m.exports.useLayoutEffect(()=>{const $=w.current;return document.body.appendChild($),()=>{document.body.removeChild($)}},[]);function N($){$.target===P.current&&l()}const k=e.createElement("div",{className:y("modal-mask",{"modal-show":n}),ref:P,onMouseDown:N},e.createElement("div",{className:y("modal",`modal-${o}`,f),style:u},e.createElement("div",{className:"modal-title"},s),e.createElement("div",{className:y("modal-body",c),style:i},p),a&&e.createElement("div",{className:"footer"},e.createElement(Ce,{onClick:()=>l()},x("cancel")),e.createElement(Ce,{type:"primary",onClick:()=>r()},x("ok")))));return xe.exports.createPortal(k,w.current)}const Mt={success:"check",info:"info",warning:"info",error:"close"};function Ot(t){const{message:n="",type:s="info",inside:o=!1,children:a,className:r,style:l}=t,c=y("alert",`alert-${o?"note":"box"}-${s}`,r);return e.createElement("div",{className:c,style:l},e.createElement("span",{className:"alert-icon"},e.createElement(H,{type:Mt[s],size:26})),n?e.createElement("p",{className:"alert-message"},n):e.createElement("div",{className:"alert-message"},a))}function Ce(t){const{type:n="normal",onClick:s=_,children:o,className:a,style:r,disiabled:l}=t,c=y("button",`button-${n}`,a,{"button-disabled":l});return e.createElement("button",{className:c,style:r,onClick:s,disabled:l},o)}function de(t){const[n,s]=rt(t),o=m.exports.useMemo(()=>{function a(r,l){typeof r=="string"?s(c=>{const i=r,f=l;c[i]=f}):typeof r=="function"?s(r):typeof r=="object"&&s(c=>{const i=r;for(const f of Object.keys(i)){const u=f;c[u]=i[u]}})}return a},[s]);return[n,o]}function Ut(t,n=0){if(t.length<2)throw new Error("List requires at least two elements");const[s,o]=m.exports.useState(n);function a(){o((s+1)%t.length)}return{current:m.exports.useMemo(()=>t[s],[t,s]),next:a}}function Pe(t=!1){const[n,s]=m.exports.useState(t);function o(){s(!1)}function a(){s(!0)}return{visible:n,hide:o,show:a}}function Ye(t){const{className:n,checked:s=!1,onChange:o=_}=t,a=y("checkbox",{checked:s},n);function r(){o(!s)}return e.createElement("div",{className:a,onClick:r},e.createElement(H,{className:"checkbox-icon",type:"check",size:18}),e.createElement("div",null,t.children))}function ue(t){const{color:n,className:s,style:o}=t,a=y("tag",s),r=C({color:n},o),l=L(C({},t),{className:a,style:r});return e.createElement("span",C({},l),t.children)}function Ht(t){const n=y("spinner",t.className);return e.createElement("div",{className:n},e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})))}function Ve(t){const n=y("loading","visible",t.className);return t.visible?e.createElement("div",{className:n},e.createElement(Ht,{className:t.spinnerClassName})):null}function jt(t){var a,r,l;const n=m.exports.useRef(document.createElement("div"));m.exports.useLayoutEffect(()=>{const c=n.current;return document.body.appendChild(c),()=>{document.body.removeChild(c)}},[]);const s="absolute h-full right-0 transition-transform transform translate-x-full duration-100 pointer-events-auto",o=e.createElement("div",{className:y(t.className,"absolute inset-0 pointer-events-none z-9999")},e.createElement(W,{className:y(s,{"translate-x-[-2em]":t.visible},"drawer"),style:{width:(a=t.width)!=null?a:450,height:"auto",marginTop:"4em",background:"#16222a"}},t.children));return xe.exports.createPortal(o,(l=(r=t.containerRef)==null?void 0:r.current)!=null?l:n.current)}ye.extend(lt);function ke(t,n){const s=n==="en_US"?"en":"zh-cn";return ye().locale(s).from(t)}function zt(t){const{translation:n}=D(),s=m.exports.useMemo(()=>n("Connections").t,[n]),{className:o,style:a}=t,r=y("flex flex-wrap px-1",o);function l(c){var i;(i=t.onChange)==null||i.call(t,c)}return e.createElement("div",{className:r,style:a},e.createElement("div",{className:y("connections-devices-item mb-2 text-xs",{selected:t.selected===""}),onClick:()=>l("")},s("filter.all")),t.devices.map(c=>e.createElement("div",{key:c.label,className:y("connections-devices-item mb-2 text-xs",{selected:t.selected===c.label}),onClick:()=>l(c.label)},c.label," (",c.number,")")))}function Wt(t){var o,a,r,l,c,i,f,u,p,E,x,w;const{translation:n}=D(),s=m.exports.useMemo(()=>n("Connections").t,[n]);return e.createElement("div",{className:y(t.className,"text-xs flex flex-col text-[#A2ADB5] bg-[#1b2831]")},e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.id")),e.createElement("span",{className:"font-mono"},t.connection.id)),e.createElement("div",{className:"flex my-3 justify-between"},e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},s("info.network")),e.createElement("span",{className:"font-mono"},(o=t.connection.metadata)==null?void 0:o.network)),e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},s("info.inbound")),e.createElement("span",{className:"font-mono"},(a=t.connection.metadata)==null?void 0:a.type))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.process")),e.createElement("span",{className:"font-mono flex-1 break-all"},((r=t.connection.metadata)==null?void 0:r.process)?`${t.connection.metadata.process}`:s("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.host")),e.createElement("span",{className:"font-mono flex-1 break-all"},((l=t.connection.metadata)==null?void 0:l.host)?`${t.connection.metadata.host}:${(c=t.connection.metadata)==null?void 0:c.destinationPort}`:((i=t.connection.metadata)==null?void 0:i.destinationIP)?`${t.connection.metadata.destinationIP}:${(f=t.connection.metadata)==null?void 0:f.destinationPort}`:s("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.srcIP")),e.createElement("span",{className:"font-mono"},`${(u=t.connection.metadata)==null?void 0:u.sourceIP}:${(p=t.connection.metadata)==null?void 0:p.sourcePort}`)),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.rule")),e.createElement("span",{className:"font-mono"},t.connection.rule&&`${t.connection.rule}${t.connection.rulePayload&&` [${t.connection.rulePayload}] `}`)),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.chains")),e.createElement("span",{className:"font-mono flex-1 break-all"},(E=t.connection.chains)==null?void 0:E.slice().reverse().join(" / "))),e.createElement("div",{className:"flex my-3 justify-between"},e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},s("info.upload")),e.createElement("span",{className:"font-mono"},Z((x=t.connection.upload)!=null?x:0))),e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},s("info.download")),e.createElement("span",{className:"font-mono"},Z((w=t.connection.download)!=null?w:0)))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.status")),e.createElement("span",{className:"font-mono"},t.connection.completed?e.createElement("span",{className:"text-red"},s("info.closed")):e.createElement("span",{className:"text-green"},s("info.opening")))))}class Gt{constructor(){this.connections=new Map,this.saveDisconnection=!1}appendToSet(n){var o;const s=n.reduce((a,r)=>a.set(r.id,r),new Map);for(const a of this.connections.keys())if(!s.has(a))if(!this.saveDisconnection)this.connections.delete(a);else{const r=this.connections.get(a);r!=null&&this.connections.set(a,fe(r,l=>{l.completed=!0,l.uploadSpeed=0,l.downloadSpeed=0}))}for(const a of s.keys()){if(!this.connections.has(a)){this.connections.set(a,L(C({},s.get(a)),{uploadSpeed:0,downloadSpeed:0}));continue}const r=this.connections.get(a),l=s.get(a);(o=this.connections)==null||o.set(a,L(C({},l),{uploadSpeed:l.upload-r.upload,downloadSpeed:l.download-r.download}))}}toggleSave(){var n,s;if(this.saveDisconnection){this.saveDisconnection=!1;for(const o of this.connections.keys())((s=(n=this.connections)==null?void 0:n.get(o))==null?void 0:s.completed)&&this.connections.delete(o)}else this.saveDisconnection=!0;return this.saveDisconnection}getConnections(){return[...this.connections.values()]}}function _t(){const t=m.exports.useMemo(()=>new Gt,[]),n=m.exports.useRef(!0),[s,o]=m.exports.useState([]),[a,r]=m.exports.useState(!1),l=m.exports.useCallback(function(i){t.appendToSet(i),n.current&&o(t.getConnections()),n.current=!n.current},[t]),c=m.exports.useCallback(function(){const i=t.toggleSave();r(i),i||o(t.getConnections()),n.current=!0},[t]);return{connections:s,feed:l,toggleSave:c,save:a}}var h;(function(t){t.Host="host",t.Process="process",t.Network="network",t.Type="type",t.Chains="chains",t.Rule="rule",t.Speed="speed",t.Upload="upload",t.Download="download",t.UploadSpeed="uploadSpeed",t.DownloadSpeed="downloadSpeed",t.SourceIP="sourceIP",t.Time="time"})(h||(h={}));const Yt=new Set([h.Network,h.Type,h.Speed,h.Upload,h.Download,h.SourceIP,h.Time]);function qe(t,n){switch(!0){case t!==0:return`\u2191 ${Z(t)}/s`;case n!==0:return`\u2193 ${Z(n)}/s`;default:return"-"}}function Vt(){const{translation:t,lang:n}=D(),{meta:s}=ie(),o=m.exports.useMemo(()=>t("Connections").t,[t]),a=It(),r=I(),l=m.exports.useRef(null),[c,i]=de({uploadTotal:0,downloadTotal:0}),{visible:f,show:u,hide:p}=Pe();function E(){r.closeAllConnections().finally(()=>p())}const{connections:x,feed:w,save:P,toggleSave:N}=_t(),k=m.exports.useMemo(()=>x.map(d=>({id:d.id,host:`${d.metadata.host||d.metadata.destinationIP}:${d.metadata.destinationPort}`,chains:d.chains.slice().reverse().join(" / "),rule:d.rulePayload?`${d.rule} :: ${d.rulePayload}`:d.rule,time:new Date(d.start).getTime(),upload:d.upload,download:d.download,sourceIP:d.metadata.sourceIP,type:d.metadata.type,process:d.metadata.process,network:d.metadata.network.toUpperCase(),speed:{upload:d.uploadSpeed,download:d.downloadSpeed},completed:!!d.completed,original:d})),[x]),$=m.exports.useMemo(()=>{const d=ct(x,"metadata.sourceIP");return Object.keys(d).map(F=>({label:F,number:d[F].length})).sort((F,v)=>F.label.localeCompare(v.label))},[x]),j=m.exports.useRef(null),{x:M}=it(j),O=m.exports.useMemo(()=>[{Header:o(`columns.${h.Host}`),accessor:h.Host,minWidth:180,width:180},{Header:o(`columns.${h.Download}`),accessor:h.Download,minWidth:100,width:100,sortDescFirst:!0},{Header:o(`columns.${h.Upload}`),accessor:h.Upload,minWidth:100,width:100,sortDescFirst:!0},{id:h.DownloadSpeed,Header:o(`columns.${h.DownloadSpeed}`),accessor(d){return d.speed.download},minWidth:110,maxWidth:110,sortDescFirst:!0},{id:h.UploadSpeed,Header:o(`columns.${h.UploadSpeed}`),accessor(d){return d.speed.upload},minWidth:110,maxWidth:110,sortDescFirst:!0},{Header:o(`columns.${h.Chains}`),accessor:h.Chains,minWidth:300,width:300},{Header:o(`columns.${h.Rule}`),accessor:h.Rule,minWidth:140,width:140},{Header:o(`columns.${h.Time}`),accessor:h.Time,minWidth:130,maxWidth:130,sortType(d,F){return F.original.time-d.original.time}},{Header:o(`columns.${h.SourceIP}`),accessor:h.SourceIP,minWidth:100,width:100,filter:"equals"},{Header:o(`columns.${h.Type}`),accessor:h.Type,minWidth:70,maxWidth:70},{Header:o(`columns.${h.Network}`),accessor:h.Network,minWidth:70,maxWidth:70}],[o]);m.exports.useLayoutEffect(()=>{function d(F){for(const v of F)i({uploadTotal:v.uploadTotal,downloadTotal:v.downloadTotal}),w(v.connections)}return a==null||a.subscribe("data",d),()=>{a==null||a.unsubscribe("data",d),a==null||a.destory()}},[a,w,i]);const{getTableProps:V,getTableBodyProps:q,headerGroups:G,rows:U,prepareRow:te,setFilter:g}=le.exports.useTable({columns:O,data:k,autoResetSortBy:!1,autoResetFilters:!1,initialState:{sortBy:[{id:h.Time,desc:!1}]}},le.exports.useResizeColumns,le.exports.useBlockLayout,le.exports.useFilters,le.exports.useSortBy),X=m.exports.useMemo(()=>G[0],[G]),b=m.exports.useCallback(function(d){switch(d.column.id){case h.UploadSpeed:return qe(d.value,0);case h.DownloadSpeed:return qe(0,d.value);case h.Upload:case h.Download:return Z(d.value);case h.Time:return ke(new Date(d.value),n);default:return d.value}},[n]),[T,ne]=m.exports.useState("");function R(d){ne(d),g==null||g(h.SourceIP,d||void 0)}const[A,S]=de({visible:!1,selectedID:"",connection:{}});function z(d){S({visible:!0,selectedID:d})}function se(){S(d=>{d.connection.completed=!0}),r.closeConnection(A.selectedID)}const K=ut(A.connection);return m.exports.useEffect(()=>{var F;const d=(F=k.find(v=>v.id===A.selectedID))==null?void 0:F.original;d?S(v=>{v.connection=C({},d),A.selectedID===K.current.id&&(v.connection.completed=K.current.completed)}):Object.keys(K.current).length!==0&&!K.current.completed&&S(v=>{v.connection.completed=!0})},[k,A.selectedID,K,S]),e.createElement("div",{className:"page"},e.createElement(J,{title:o("title")},e.createElement("div",{className:"cursor-default flex-1 connections-filter flex flex-col text-xs md:flex md:flex-row md:text-sm"},e.createElement("span",{className:"mr-4"},`${o("total.upload")} ${Z(c.uploadTotal)}`),e.createElement("span",{className:"mr-4"},`${o("total.download")} ${Z(c.downloadTotal)}`)),e.createElement(Ye,{className:"connections-filter text-xs md:text-sm",checked:P,onChange:N},o("keepClosed")),e.createElement(H,{className:"connections-filter dangerous",onClick:u,type:"close-all",size:20})),$.length>1&&e.createElement(zt,{devices:$,selected:T,onChange:R}),e.createElement(W,{ref:l,className:"connections-card relative"},e.createElement("div",L(C({},V()),{className:"flex flex-col flex-1 w-full overflow-auto",style:{flexBasis:0},ref:j}),e.createElement("div",L(C({},X.getHeaderGroupProps()),{className:"connections-header"}),X.headers.map((d,F)=>{const v=d,pe=v.id;return e.createElement("div",L(C({},v.getHeaderProps()),{className:y("connections-th",{resizing:v.isResizing,fixed:M>0&&v.id===h.Host,meta:v.id===h.Process&&!s}),key:pe}),e.createElement("div",L(C({},v.getSortByToggleProps()),{className:y({meta:v.id===h.Process&&!s})}),d.render("Header"),v.isSorted?v.isSortedDesc?" \u2193":" \u2191":null),F!==X.headers.length-1&&e.createElement("div",L(C({},v.getResizerProps()),{className:"connections-resizer"})))})),e.createElement("div",L(C({},q()),{className:"flex-1"}),U.map((d,F)=>(te(d),e.createElement("div",L(C({},d.getRowProps()),{className:y("cursor-default connections-item select-none",{tableRow:F%2==0}),key:d.original.id,onClick:()=>z(d.original.id)}),d.cells.map(v=>{const pe=y("connections-block",{"text-center":Yt.has(v.column.id),completed:d.original.completed},{fixed:M>0&&v.column.id===h.Host},{fixed2:M>0&&v.column.id===h.Host&&F%2==0},{meta:v.column.id===h.Process&&!s});return e.createElement("div",L(C({},v.getCellProps()),{className:pe,key:v.column.id}),b(v))}))))))),e.createElement(_e,{title:o("closeAll.title"),show:f,onClose:p,onOk:E},o("closeAll.content")),e.createElement(jt,{containerRef:l,visible:A.visible,width:450},e.createElement("div",{className:"flex h-8 justify-between items-center"},e.createElement("span",{className:"font-bold pl-3 text-orange-400"},o("info.title")),e.createElement(H,{type:"close",size:16,className:"cursor-pointer",onClick:()=>S("visible",!1)})),e.createElement(Wt,{className:"mt-3 px-5",connection:A.connection}),e.createElement("div",{className:"flex mt-3 pr-3 justify-end"},e.createElement(Ce,{type:"danger",disiabled:A.connection.completed,onClick:()=>se()},o("info.closeConnection")))))}function qt(){const{translation:t}=D(),{t:n}=t("Settings"),{hostname:s,port:o,secret:a}=ce(),[r,l]=B(we),[c,i]=de({hostname:"",port:"",secret:""});m.exports.useEffect(()=>{i({hostname:s,port:o,secret:a})},[s,o,a,i]);const f=he(Me);function u(){const{hostname:p,port:E,secret:x}=c;f([{hostname:p,port:E,secret:x}])}return e.createElement(_e,{show:!r,title:n("externalControllerSetting.title"),bodyClassName:"external-controller",onClose:()=>l(!0),onOk:u},e.createElement(Ot,{type:"info",inside:!0},e.createElement("p",null,n("externalControllerSetting.note"))),e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:"font-bold my-1 w-14 md:my-3"},n("externalControllerSetting.host")),e.createElement(ee,{className:"flex-1 my-1 md:my-3",align:"left",inside:!0,value:c.hostname,onChange:p=>i("hostname",p),onEnter:u})),e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"font-bold my-1 w-14 md:my-3"},n("externalControllerSetting.port")),e.createElement(ee,{className:"flex-1 my-1 w-14 md:my-3",align:"left",inside:!0,value:c.port,onChange:p=>i("port",p),onEnter:u})),e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"font-bold my-1 w-14 md:my-3"},n("externalControllerSetting.secret")),e.createElement(ee,{className:"flex-1 my-1 w-14 md:my-3",align:"left",inside:!0,value:c.secret,onChange:p=>i("secret",p),onEnter:u})))}function Xt(){var i,f;const t=m.exports.useRef(null),n=m.exports.useRef([]),[s,o]=m.exports.useState([]),{translation:a}=D(),{t:r}=a("Logs"),l=Ge(),c=m.exports.useRef((f=(i=t.current)==null?void 0:i.scrollHeight)!=null?f:0);return m.exports.useLayoutEffect(()=>{var p;const u=t.current;u!=null&&c.current===u.scrollTop+u.clientHeight&&(u.scrollTop=u.scrollHeight-u.clientHeight),c.current=(p=u==null?void 0:u.scrollHeight)!=null?p:0}),m.exports.useEffect(()=>{function u(p){n.current=n.current.slice().concat(p.map(E=>L(C({},E),{time:new Date}))),o(n.current)}return l!=null&&(l.subscribe("data",u),n.current=l.buffer(),o(n.current)),()=>l==null?void 0:l.unsubscribe("data",u)},[l]),e.createElement("div",{className:"page"},e.createElement(J,{title:r("title")}),e.createElement(W,{className:"flex flex-col flex-1 mt-2.5 md:mt-4"},e.createElement("ul",{className:"logs-panel",ref:t},s.map((u,p)=>e.createElement("li",{className:"leading-5 inline-block ",style:{fontSize:"11px"},key:p},e.createElement("span",{className:"mr-2 text-orange-400"},"[",ye(u.time).format("YYYY-MM-DD HH:mm:ss"),"]"),e.createElement(e.Fragment,null,e.createElement("span",{className:y({"text-teal-400":u.type==="debug","text-rose-400":u.type==="error","text-pink-400":u.type==="warning","text-sky-400":u.type==="info"})},"[",u.type.toUpperCase(),"]")),e.createElement("span",null," ",u.payload))))))}var Y;(function(t){t.SPEED_NOTIFY="speed-notify",t.GROUP_NOTIFY="group-notify",t.Provider_NOTIFY="provider-notify"})(Y||(Y={}));class Kt{constructor(){this.EE=new Te}notifySpeedTest(){this.EE.emit(Y.SPEED_NOTIFY)}notifyGroupTest(){this.EE.emit(Y.GROUP_NOTIFY)}notifyProviderTest(){this.EE.emit(Y.Provider_NOTIFY)}subscribe(n,s){this.EE.addListener(n,s)}unsubscribe(n,s){this.EE.removeListener(n,s)}}var me=new Kt;const Xe={"#909399":0,"#57b366":260,"#ff9a28":600,"#ff3e5e":1/0};function Ke(t){const{config:n,className:s}=t,{proxies:o,set:a}=ae(),r=I(),l=m.exports.useCallback(async E=>{const{data:{delay:x}}=await r.getProxyDelay(E);return x},[r]),c=m.exports.useCallback(async function(){for(let E of o)if(E.name===n.name){const x=await re.fromPromise(l(n.name),P=>P),w=x.isErr()?0:x.value;a(P=>{const N=P.proxies.find(k=>k.name===n.name);N!=null&&N.history.push({time:Date.now().toString(),delay:w})})}},[n.name,l,a,o]),i=m.exports.useMemo(()=>{var E;return((E=n.history)==null?void 0:E.length)?n.history.slice(-1)[0].delay:0},[n]);m.exports.useLayoutEffect(()=>{const E=()=>{c()};return me.subscribe(Y.SPEED_NOTIFY,E),()=>me.unsubscribe(Y.SPEED_NOTIFY,E)},[c]);const f=m.exports.useMemo(()=>i===0,[i]),u=m.exports.useMemo(()=>Object.keys(Xe).find(E=>i<=Xe[E]),[i]),p=f?void 0:u;return e.createElement("div",{className:y("proxy-item",{"proxy-error":f},s)},e.createElement("span",{className:"proxy-type",style:{backgroundColor:p}},n.type),e.createElement("p",{className:"proxy-name"},n.name),e.createElement("p",{className:"proxy-delay",style:{color:u}},i===0?"-":`${i}ms`))}function Jt(t){const{markProxySelected:n}=ae(),[s]=B(We),{data:o}=Ue(),a=I(),{config:r}=t;async function l(f){if(await a.changeProxySelected(t.config.name,f),n(t.config.name,f),o.breakConnections){const u=[],p=await a.getConnections();for(const E of p.data.connections)E.chains.includes(t.config.name)&&u.push(E.id);await Promise.all(u.map(E=>a.closeConnection(E)))}}const c=m.exports.useMemo(()=>{var u;const f=new Set;for(const p of r.all){const E=(u=s.get(p))==null?void 0:u.history;(E==null?void 0:E.length)&&E.slice(-1)[0].delay===0&&f.add(p)}return f},[r.all,s]),i=r.type==="Selector";return e.createElement("div",{className:"proxy-group"},e.createElement("div",{className:"flex h-10 mt-2 w-full items-center justify-between md:h-11 md:mt-4 md:w-auto md:flex-col "},e.createElement("span",{className:"h-6 px-5 w-2/3 overflow-hidden overflow-ellipsis whitespace-nowrap md:w-36 cursor-default",title:r.name},r.name),e.createElement(ue,{className:"mr-5 md:mr-0 cursor-default "},r.type)),e.createElement("div",{className:"flex-1 pb-4 md:py-4"},e.createElement(Rt,{className:"mx-5 md:ml-8",title:r.name,data:r.all,onClick:l,errSet:c,select:r.now,canClick:i,rowHeight:42})))}function Qt(t){const{update:n}=je(),{translation:s,lang:o}=D(),a=I(),{provider:r}=t,{t:l}=s("Proxies"),[c,i]=m.exports.useState(!1),{visible:f,hide:u,show:p}=Pe();function E(){p(),a.healthCheckProvider(r.name).then(async()=>await n()).finally(()=>u())}function x(){i(!c)}m.exports.useLayoutEffect(()=>{const N=()=>{a.healthCheckProvider(r.name).then(async()=>await n()).finally(()=>u())};return me.subscribe(Y.Provider_NOTIFY,N),()=>me.unsubscribe(Y.Provider_NOTIFY,N)},[]);function w(){p(),a.updateProvider(r.name).then(async()=>await n()).finally(()=>u())}const P=m.exports.useMemo(()=>r.proxies.slice().sort((N,k)=>-1*Se(N,k)),[r.proxies]);return e.createElement(W,{className:"proxy-provider"},e.createElement(Ve,{visible:f}),e.createElement("div",{className:"flex flex-col justify-between md:flex-row md:items-center "},e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:"mr-6"},r.name),e.createElement(ue,null,r.vehicleType),e.createElement(ue,{className:"rule-provider-behavior"}," ",l("providerCount"),": ",P.length)),e.createElement("div",{className:"flex pt-3 items-center md:pt-0"},r.updatedAt&&e.createElement("span",{className:"text-sm"},`${l("providerUpdateTime")}: ${ke(new Date(r.updatedAt),o)}`),e.createElement(H,{className:"cursor-pointer text-red pl-5",type:"healthcheck",size:18,onClick:E}),e.createElement(H,{className:"cursor-pointer pl-5",type:"update",size:18,onClick:w}),e.createElement("span",{className:"tag rule-provider-behavior cursor-pointer right-[-20px] md:right-0",onClick:x,style:{margin:"0 0 0 20px",position:"relative"}}," ",l(c?"collapseText":"expandText")))),e.createElement("ul",{className:"proxies-list",style:{display:c?"":"none"}},P.map(N=>e.createElement("li",{key:N.name},e.createElement(Ke,{className:"proxy-provider-item",config:N})))))}var Je;(function(t){t[t.None=0]="None",t[t.Asc=1]="Asc",t[t.Desc=2]="Desc"})(Je||(Je={}));const Zt={[0]:"sort",[1]:"sort-ascending",[2]:"sort-descending"};function Se(t,n){const s=t.history.length>0?t.history.slice(-1)[0].delay:0;return((n.history.length>0?n.history.slice(-1)[0].delay:0)||Number.MAX_SAFE_INTEGER)-(s||Number.MAX_SAFE_INTEGER)}function en(){me.notifySpeedTest()}function tn(){const{groups:t,global:n}=ae(),{data:s,set:o}=Ue(),{general:a}=Ne(),{translation:r}=D(),{t:l}=r("Proxies"),c=m.exports.useMemo(()=>a.mode==="global"?[n]:t,[a,t,n]);return e.createElement(e.Fragment,null,c.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(J,{title:l("groupTitle")},e.createElement(Ye,{className:"cursor-pointer text-xs md:text-sm text-shadow-primary text-primary-600",checked:s.breakConnections,onChange:i=>o("breakConnections",i)},l("breakConnectionsText"))),e.createElement(W,{className:"my-2.5 p-0 md:my-4"},e.createElement("ul",{className:"list-none"},c.map(i=>e.createElement("li",{className:"proxies-group-item",key:i.name},e.createElement(Jt,{config:i})))))))}function nn(){const{providers:t}=je(),{translation:n}=D(),{t:s}=n("Proxies");return e.createElement(e.Fragment,null,t.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(J,{title:s("providerTitle")}),e.createElement("ul",{className:"list-none"},t.map(o=>e.createElement("li",{className:"my-2.5 md:my-4",key:o.name},e.createElement(Qt,{provider:o}))))))}function sn(){const{proxies:t}=ae(),{translation:n}=D(),{t:s}=n("Proxies"),{current:o,next:a}=Ut([0,1,2]),r=m.exports.useMemo(()=>{switch(o){case 2:return t.slice().sort((l,c)=>Se(l,c));case 1:return t.slice().sort((l,c)=>-1*Se(l,c));default:return t.slice()}},[o,t]);return e.createElement(e.Fragment,null,r.length!==0&&e.createElement("div",{className:"flex flex-col "},e.createElement(J,{title:s("title")},e.createElement(H,{className:"ml-3",type:Zt[o],onClick:a,size:20}),e.createElement(H,{className:"ml-3",type:"speed",size:20}),e.createElement("span",{className:"proxies-speed-test text-xs md:text-sm",onClick:en},s("speedTestText"))),e.createElement(W,{className:"proxy-provider my-2.5 md:my-4"},e.createElement("ul",{className:"proxies-list"},r.map(l=>e.createElement("li",{key:l.name},e.createElement(Ke,{config:l})))))))}function on(){return e.createElement("div",{className:"page"},e.createElement(tn,null),e.createElement(nn,null),e.createElement(sn,null))}function an(t){const{update:n}=Oe(),{translation:s,lang:o}=D(),a=I(),{provider:r}=t,{t:l}=s("Rules"),{visible:c,hide:i,show:f}=Pe();function u(){f(),a.updateRuleProvider(r.name).then(async()=>await n()).finally(()=>i())}const p=y("rule-provider-icon",{"rule-provider-loading":c});return e.createElement("div",{className:"rule-provider"},e.createElement("div",{className:"rule-provider-header"},e.createElement("div",{className:"rule-provider-header-part"},e.createElement("span",{className:"rule-provider-name"},r.name),e.createElement(ue,null,r.vehicleType),e.createElement(ue,{className:"rule-provider-behavior"},r.behavior),e.createElement("span",{className:"rule-provider-update"},`${l("ruleCount")}: ${r.ruleCount}`)),e.createElement("div",{className:"rule-provider-header-part"},r.updatedAt&&e.createElement("span",{className:"rule-provider-update"},`${l("providerUpdateTime")}: ${ke(new Date(r.updatedAt),o)}`),e.createElement(H,{className:p,type:"update",size:18,onClick:u}))))}function rn(){const{providers:t}=Oe(),{translation:n}=D(),{t:s}=n("Rules");return e.createElement(e.Fragment,null,t.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(J,{title:s("providerTitle")}),e.createElement(W,{className:"divide-y rounded mt-4 p-0"},t.map(o=>e.createElement(an,{key:o.name,provider:o})))))}function ln(){const{rules:t,update:n}=$t(),{translation:s}=D(),{t:o}=s("Rules");oe("rules",n);function a({index:r,style:l}){const c=t[r];return e.createElement("li",{className:"rule-item",style:l},e.createElement("div",{className:"flex py-1"},e.createElement("div",{className:"text-center w-40 rule-type"},c.type),e.createElement("div",{className:"flex-1 text-center payload"},c.payload),e.createElement("div",{className:"text-center w-40 rule-proxy"},c.proxy)))}return e.createElement("div",{className:"page"},e.createElement(rn,null),e.createElement(J,{className:"not-first:mt-7.5",title:o("title")}),e.createElement(W,{className:"flex flex-col flex-1 mt-2.5 p-0 md:mt-4 focus:outline-none"},e.createElement(mt,{className:"min-h-120"},({height:r,width:l})=>e.createElement(dt,{height:r,width:l,itemCount:t.length,itemSize:50},a))))}const cn=[{label:"\u4E2D\u6587",value:"zh_CN"},{label:"English",value:"en_US"}];function un(){const{premium:t}=ie(),{general:n,update:s}=Ne(),o=he(we),a=ce(),{translation:r,setLang:l,lang:c}=D(),{t:i}=r("Settings"),f=I(),[u,p]=de({mixedProxyPort:0,socks5ProxyPort:7891,httpProxyPort:7890,redirProxyPort:7892});m.exports.useEffect(()=>{var g,X,b,T;p("socks5ProxyPort",(g=n==null?void 0:n.socksPort)!=null?g:0),p("httpProxyPort",(X=n==null?void 0:n.port)!=null?X:0),p("mixedProxyPort",(b=n==null?void 0:n.mixedPort)!=null?b:0),p("redirProxyPort",(T=n==null?void 0:n.redirPort)!=null?T:0)},[n,p]);async function E(g){await f.updateConfig({mode:g}),await s()}async function x(g){await f.updateConfig({"log-level":g}),await s()}function w(g){l(g)}async function P(){await f.updateConfig({port:u.httpProxyPort}),await s()}async function N(){await f.updateConfig({"socks-port":u.socks5ProxyPort}),await s()}async function k(){await f.updateConfig({"mixed-port":u.mixedProxyPort}),await s()}async function $(){await f.updateConfig({"redir-port":u.redirProxyPort}),await s()}async function j(g){await f.updateConfig({"allow-lan":g}),await s()}const{hostname:M,port:O}=a,{allowLan:V,mode:q,logLevel:G}=n,U=m.exports.useMemo(()=>{const g=[{label:i("values.global"),value:"Global"},{label:i("values.rules"),value:"Rule"},{label:i("values.direct"),value:"Direct"}];return t&&g.push({label:i("values.script"),value:"Script"}),g},[i,t]),te=[{label:"debug",value:"debug"},{label:"info",value:"info"},{label:"warn",value:"warning"},{label:"error",value:"error"},{label:"silent",value:"silent"}];return e.createElement("div",{className:"page"},e.createElement(J,{title:i("title")}),e.createElement(W,{className:"settings-card"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between "},e.createElement("span",{className:"font-bold label"},i("labels.language")),e.createElement(ve,{options:cn,value:c,onSelect:g=>w(g)})),e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between "},e.createElement("span",{className:"font-bold label"},i("labels.allowConnectFromLan")),e.createElement(wt,{checked:V,onChange:j})),e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between "},e.createElement("span",{className:"font-bold label"},i("labels.proxyMode")),e.createElement(ve,{options:U,value:pt(q),onSelect:E})),e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between  "},e.createElement("span",{className:"font-bold label"},i("labels.logLevel")),e.createElement(ve,{options:te,value:ft(G),onSelect:x})))),e.createElement(W,{className:"settings-card"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},i("labels.mixedProxyPort")),e.createElement(ee,{className:"w-28",value:u.mixedProxyPort,onChange:g=>p("mixedProxyPort",+g),onBlur:k})),e.createElement("div",{className:"flex  w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},i("labels.redirProxyPort")),e.createElement(ee,{className:"w-28",value:u.redirProxyPort,onChange:g=>p("redirProxyPort",+g),onBlur:$}))),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},i("labels.socks5ProxyPort")),e.createElement(ee,{className:"w-28",value:u.socks5ProxyPort,onChange:g=>p("socks5ProxyPort",+g),onBlur:N})),e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},i("labels.httpProxyPort")),e.createElement(ee,{className:"w-28",value:u.httpProxyPort,onChange:g=>p("httpProxyPort",+g),onBlur:P})),e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},i("labels.externalController")),e.createElement("span",{className:y("external-controller"),onClick:()=>o(!1)},`${M}:${O}`)))))}var mn="./assets/img.7ec09e60.png";function dn(t){const{routes:n}=t,{translation:s}=D(),{version:o,meta:a,premium:r}=ie(),{t:l}=s("SideBar"),c=n.map(({path:i,name:f,noMobile:u})=>e.createElement("li",{className:y("item",{"no-mobile":u}),key:f},e.createElement(Et,{to:i,className:({isActive:p})=>y({active:p})},l(f))));return e.createElement("div",{className:"sidebar"},e.createElement("img",{src:mn,alt:"logo",className:"sidebar-logo"}),e.createElement("ul",{className:"sidebar-menu"},c),e.createElement("div",{className:"sidebar-version"},e.createElement("span",{className:"sidebar-version-label"},"Clash ",l("Version")),e.createElement("span",{className:"sidebar-version-label"}," ",a?"Meta "+o.substring(0,6):r?"Premium "+o:o)))}function pn(){Ge();const t=[{path:"/proxies",name:"Proxies",element:e.createElement(on,null)},{path:"/logs",name:"Logs",element:e.createElement(Xt,null)},{path:"/rules",name:"Rules",element:e.createElement(ln,null),noMobile:!0},{path:"/connections",name:"Connections",element:e.createElement(Vt,null),noMobile:!1},{path:"/settings",name:"Settings",element:e.createElement(un,null)}];return e.createElement("div",{className:y("app",{"not-clashx":!Ie()})},e.createElement(dn,{routes:t}),e.createElement("div",{className:"page-container"},e.createElement(ht,null,e.createElement($e,{path:"/",element:e.createElement(xt,{to:"/proxies",replace:!0})}),t.map(n=>e.createElement($e,{path:n.path,key:n.path,element:n.element})))),e.createElement(qt,null))}function fn(){const t=document.getElementById("root"),n=e.createElement(yt,null,e.createElement(m.exports.Suspense,{fallback:e.createElement(Ve,{visible:!0})},e.createElement(pn,null)));xe.exports.render(n,t)}fn();
